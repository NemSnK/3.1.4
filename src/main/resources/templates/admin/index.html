<!doctype html>
<html lang="ru" xmlns="http://www.w3.org/1999/xhtml"
      xmlns:th="http://www.thymeleaf.org"
      xmlns:sec="http://www.thymeleaf.org/thymeleaf-extras-springsecurity5">

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.0/dist/css/bootstrap.min.css" rel="stylesheet"
          integrity="sha384-gH2yIJqKdNHPEq0n4Mqa/HGKIhSkIHeL5AyhkYV8i59U5AR6csBvApHHNl/vI1Bx" crossorigin="anonymous">
    <link rel="stylesheet" href="mycss.css">
    <style>

        .delete {
            width: 40%;
            height: auto;
            text-align: center;
            padding: 0;
            border: 2px solid #c3c3c3;
            border-radius: 5px;
            display: none;
            position: absolute;
            top: 0;
            right: 0;
            bottom: 0;
            left: 0;
            margin: auto;
            background: white;
        }
        .delete:target {display: block;}

        .modalwindow {
            width: 100%;
            padding: 0;
            margin: 0 auto;

        }
        .head {
            width: 100%;
            height: 40px;
            border-bottom: 2px solid #757575; /* Белая рамка */
        }

    </style>

</head>
<body style="height: auto;">
<nav class="navbar navbar-expand-lg navbar-light" style="background-color: #3D3E3E;">
    <div class="container-fluid">
        <div class="collapse navbar-collapse" id="navbarSupportedContent">
            <ul class="navbar-nav me-auto mb-2 mb-lg-0" style="color:#EBEBEB">
                <li class="nav-item">
                    <b><a th:text="${user.getUsername()}"> VALUE </a> </b>
                </li>
                <li class="nav-item">
                    <span>&nbsp; with roles: &nbsp;</span>
                </li>
                <li class="nav-item" th:each="role : ${user.getRoles()}">
                    <a th:text="${role.toString()}"> VALUE </a> <span> &nbsp; </span>
                </li>
            </ul>
        </div>
        <div class="collapse navbar-collapse" id="navbarSupportedContent">
            <ul class="navbar-nav ms-auto mb-2 mb-lg-0">
                <li class="nav-item">
                    <a class="nav-link" style="color:#777777" href="/logout">Logout</a>
                </li>
            </ul>
        </div>
    </div>
</nav>
<div class="container-fluid">
    <div class="row">
        <div class="col-md-6" style="margin: 0; padding: 0; width: 17%; min-height: 100vh;">
            <ul style="list-style-type: none; margin: 0; padding: 0;">
                <li>
                    <a style="text-align: left; width: 100%;" href="#" class="btn btn-block btn-primary disabled"
                       type="button">
                        Admin</a>
                </li>
                <li>
                    <a style="text-align: left; text-decoration: none; width: 100%;" href="/user"
                       class="btn btn-link btn-block active" type="button">
                        User</a>
                </li>
            </ul>
        </div>
        <div class="col-md-6" style="background-color:#eaeaea;  width: 83%;">
            <h2 style="margin-left: 2%; margin-top:1%">Admin panel</h2>
            <div class="card">
                <div class="card-header">
                    <ul class="nav nav-tabs card-header-tabs" id="myTab" role="tablist">
                        <li class="nav-item" role="presentation">
                            <a th:if="${page} == 1" class="nav-link active" id="home-tab" data-bs-toggle="tab"
                               href="/admin?page=1"
                               role="tab">Users
                                table</a>
                            <a th:if="${page} == 2" class="nav-link" id="home-tab" data-bs-toggle="tab"
                               href="/admin?page=1"
                               role="tab">Users
                                table</a>
                        </li>
                        <li class="nav-item" role="presentation">
                            <a th:if="${page} == 1" class="nav-link" id="profile-tab" data-bs-toggle="tab"
                               href="/admin?page=2" role="tab">New
                                user</a>
                            <a th:if="${page} == 2" class="nav-link active" id="profile-tab" data-bs-toggle="tab"
                               href="/admin?page=2" role="tab">New
                                user</a>
                        </li>
                    </ul>
                </div>
                <div class="card-body">
                    <div class="tab-content" id="myTabContent">
                        <div id="tab_01" class="tab-pane active" role="tabpanel">
                            <table class="col-md-12" th:if="${page} == 1"
                                   style="margin-left: 0%; margin-top:0%; border-style: solid; border-width:1px; border-color:#a3a3a3; background-color:#ffffff; width:96%">
                                <thead style="border-bottom: 1px solid; border-color:#a3a3a3; background-color:#eaeaea;">
                                <tr>
                                    <th><h4 style="margin-left: 2%; margin-top: 1%;">All users</h4></th>
                                </tr>
                                </thead>
                                <tbody>
                                <tr>
                                    <td>
                                        <table style="border-top: 1px solid; border-color:#a3a3a3; margin: 2%; padding: 0px ;text-align: center; width: 96%">
                                            <thead>
                                            <tr>
                                                <th>
                                                    ID
                                                </th>
                                                <th>
                                                    First Name
                                                </th>
                                                <th>
                                                    Last Name
                                                </th>
                                                <th>
                                                    Age
                                                </th>
                                                <th>
                                                    Email
                                                </th>
                                                <th>
                                                    Role
                                                </th>
                                                <th>
                                                    Edit
                                                </th>
                                                <th>
                                                    Delete
                                                </th>
                                            </tr>
                                            </thead>
                                            <tbody style="background-color:#eaeaea; border-top: 1px solid; border-color:#a3a3a3; ">
                                            <tr th:each="user : ${users}">
                                                <td>
                                                    <a th:text="${user.getId()}"> Id </a>
                                                </td>
                                                <td>
                                                    <a th:text="${user.getFirstname()}"> Firstname </a>
                                                </td>
                                                <td>
                                                    <a th:text="${user.getLastname()}"> Lastname </a>
                                                </td>
                                                <td>
                                                    <a th:text="${user.getAge()}"> Age </a>
                                                </td>
                                                <td>
                                                    <a th:text="${user.getUsername()}"> Email </a>
                                                </td>
                                                <td>
                                                    <a th:each="role : ${user.getRoles()}" th:text="${role.toString()}">
                                                        Roles </a>
                                                </td>
                                                <td>
                                                    <div>Edit</div>
                                                </td>
                                                <td>
                                                    <div class="delete" th:id="${'delete'+user.id}">
                                                        <div class="modalwindow">
                                                            <div class="head">
                                                                <h5 style="float: left; padding: 5px; margin-left: 5px">Edit user</h5>
                                                                <nav style="float: right; padding: 5px; margin-right:5px ">
                                                                <ul style="list-style: none;">
                                                                    <li><a style="text-decoration: none; color: #777777" href="#"><b>x</b></a></li>
                                                                </ul>
                                                            </nav>
                                                            </div>
                                                            <div>
                                                                <form th:method="DELETE" th:action="@{/admin/{id}(id=${user.getId()})}">
                                                                    <input th:type="text" th:value="${user.getId()}"/>
                                                                    <input th:type="text" th:value="${user.getFirstname()}"/>
                                                                    <input th:type="text" th:value="${user.getLastname()}"/>
                                                                    <input th:type="text" th:value="${user.getAge()}"/>
                                                                    <input th:type="text" th:value="${user.getUsername()}"/>
                                                                    <select style="width: 300px;" size="2" multiple name="newRole">
                                                                        <option th:each="role:${user.getRoles()}">
                                                                            <th:block th:text="${role.toString()}"></th:block>
                                                                        </option>
                                                                    </select>
                                                                    <input th:type="submit" th:value="Delete"/>
                                                                </form>
                                                            </div>
                                                        </div>

                                                    </div>
                                                    <a href="#delete" th:href="${'#delete'+user.id}">Delete</a>

                                                </td>
                                            </tr>

                                            </tbody>
                                        </table>
                                    </td>
                                </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>
                    <div id="tab_02" class="tab-pane " role="tabpanel">
                        <div th:if="${page} == 2">
                            <table class="col-md-12"
                                   style="margin-left: 0%; margin-top:0%; border-style: solid; border-width:1px; border-color:#a3a3a3; width:96%">
                                <thead style="border-bottom: 1px solid; border-color:#a3a3a3; background-color:#eaeaea;">
                                <tr>
                                    <th><h4 style="margin-left: 2%; margin-top: 1%;">Add new user</h4></th>
                                </tr>
                                </thead>
                                <tbody>
                                <tr>
                                    <td>
                                        <form style="text-align: center;" th:method="POST" th:action="@{/admin}" th:object="${newuser}">

                                            <div style=""><label for="firstname"><b>First name</b></label></div>
                                            <div><input style="width: 300px; text-align: center;" type="text" th:field="*{firstname}"
                                                        id="firstname"/></div>
                                            <div style="color:red" th:if="${#fields.hasErrors('firstname')}"
                                                 th:errors="*{firstname}">error
                                            </div>

                                            <div style="margin-top: 15px;"><label for="lastname"><b>Last name</b></label></div>
                                            <div><input style="width: 300px; text-align: center;" type="text" th:field="*{lastname}"
                                                        id="lastname"/></div>
                                            <div style="color:red" th:if="${#fields.hasErrors('lastname')}"
                                                 th:errors="*{lastname}">error
                                            </div>

                                            <div style="margin-top: 15px;"><label for="Age"><b>Age</b></label>
                                            </div>
                                            <div><input style="width: 300px; text-align: center;" type="text" th:field="*{age}" id="age"/>
                                            </div>
                                            <div style="color:red" th:if="${#fields.hasErrors('age')}"
                                                 th:errors="*{age}">error
                                            </div>

                                            <div style="margin-top: 15px;"><label for="username"><b>Email</b></label>
                                            </div>
                                            <div><input style="width: 300px; text-align: center;" type="text" th:field="*{username}" id="username"/>
                                            </div>
                                            <div style="color:red" th:if="${#fields.hasErrors('username')}"
                                                 th:errors="*{username}">error
                                            </div>
                                            <div style="color:red" th:if="${existedUsername != null}">
                                                <a th:text="${existedUsername}"></a><span> is already exists</span>
                                            </div>


                                            <div style="margin-top: 15px;"><label for="password"><b>Password</b></label>
                                            </div>
                                            <div><input style="width: 300px; text-align: center;" type="password" th:field="*{password}" id="password"/>
                                            </div>
                                            <div style="color:red" th:if="${#fields.hasErrors('password')}"
                                                 th:errors="*{password}">error
                                            </div>
                                            <div style="margin-top: 15px;">
                                                <select style="width: 300px;" size="2" multiple name="newRole" required="required">
                                                    <option selected="selected" value="1">User</option>
                                                    <option value="2">Admin</option>
                                                </select>
                                            </div>

                                            <div style="margin-top: 15px;">
                                                <button type="submit"
                                                        style=" appearance: none; border: 0; border-radius: 5px; background: green; color: #fff; padding: 8px 16px; font-size: 16px;">
                                                    Add new user
                                                </button>
                                            </div>
                                        </form>
                                    </td>
                                </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
</body>
</html>